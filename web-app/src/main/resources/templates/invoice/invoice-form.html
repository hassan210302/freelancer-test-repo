<!DOCTYPE html>
<html lang="en" dir="ltr" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/base}">
<head>
    <th:block th:replace="~{fragments/r-combobox :: r-combobox-dependencies}"></th:block>
</head>
<body>
<main layout:fragment="content">
    <form id="invoiceForm">
        <div class="wa-stack">
            <wa-card>
                <div slot="header">Customer</div>
                <div class="wa-cluster wa-gap-s">
                    <div th:replace="fragments/customer-search :: customerSearch"></div>
                    <wa-input name="customerId" id="customerId" class="wa-visually-hidden"
                              tabindex="-1"></wa-input>
                    <wa-select style="width: 5.6rem" size="small" value="NOK" name="currencyCode" required
                               id="currencyCode">
                        <wa-option th:each="currency : ${supportedCurrencies}"
                                   th:value="${currency}" th:text="${currency}">
                        </wa-option>
                    </wa-select>
                </div>
            </wa-card>
            <wa-card>
                <div slot="header">Date</div>
                <div class="wa-cluster wa-gap-s">
                    <wa-input id="invoiceDate" name="issueDate" type="date" label="invoice date" required
                              size="small"></wa-input>
                    <wa-input id="daysUntilDue" value="14" min="0" size="small" required
                              label="days until due" type="number"></wa-input>
                    <wa-input name="dueDate" required id="dueDate" class="wa-visually-hidden"
                              tabindex="-1"></wa-input>
                </div>
            </wa-card>
            <wa-card style="overflow: auto">
                <div slot="header">Lines</div>
                <table id="invoiceTable">
                    <thead>
                    <tr>
                        <th>Product</th>
                        <th>Qty</th>
                        <th>Unit Price</th>
                        <th>Discount (%)</th>
                        <th>VAT (%)</th>
                        <th>Amount (Incl. VAT)</th>
                        <th>Actions</th>
                    </tr>
                    </thead>
                    <tbody id="invoiceBody">
                    <tr>
                        <td>
                            <wa-input size="small" style="width: 300px;" name="itemName" required value=""></wa-input>
                        </td>
                        <td>
                            <wa-input type="number" min="0" value="1" size="small" required style="width: 80px;"
                                      name="quantity"></wa-input>
                        </td>
                        <td>
                            <wa-input type="number" value="0" size="small" required style="width: 120px;"
                                      name="unitPrice"></wa-input>
                        </td>
                        <td>
                            <wa-input type="number" min="0" max="100" value="0" size="small" style="width: 80px;"
                                      name="discount"></wa-input>
                        </td>
                        <td>
                            <r-combobox placeholder="Select VAT code..." value="0" data-default-value="0" required
                                        style="font-size: var(--wa-font-size-xs);"></r-combobox>
                            <wa-input name="vatCode" type="number" value="0" class="wa-visually-hidden"
                                      tabindex="-1"></wa-input>
                        </td>
                        <td class="amount">0.00</td>
                        <td>
                            <wa-button size="small" variant="neutral" data-action="duplicate">
                                <wa-icon label="duplicate" name="copy" variant="solid" title="Duplicate"></wa-icon>
                            </wa-button>
                            <wa-button size="small" variant="danger" data-action="delete">
                                <wa-icon label="delete" name="trash" variant="solid" title="Delete"></wa-icon>
                            </wa-button>
                        </td>
                    </tr>
                    </tbody>
                    <tfoot>
                    <tr>
                        <td colspan="4"></td>
                        <td style="text-align: right;">Total:</td>
                        <td id="invoiceTotal">0.00</td>
                        <td>
                            <wa-button type="button" variant="neutral" data-action="add-row">
                                Add Row
                            </wa-button>
                        </td>
                    </tr>
                    </tfoot>
                </table>
            </wa-card>
            <wa-button type="submit" variant="success" style="width: fit-content">Submit Invoice</wa-button>
        </div>
    </form>
</main>

<th:block layout:fragment="scripts">
    <script th:inline="javascript">
        let vatCodes = [];
    </script>
    <script th:src="@{/assets/cache-config.js}"></script>
    <script th:src="@{/assets/vat-codes.js}"></script>
    <script th:src="@{/assets/fragments/customer-search.js}"></script>
    <script th:src="@{/assets/invoice/invoice-form.js}"></script>
</th:block>
</body>
</html>
